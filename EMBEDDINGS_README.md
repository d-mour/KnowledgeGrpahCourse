# Система Embeddings для поиска автомобилей

Система векторных представлений (embeddings) для семантического поиска автомобилей на основе их характеристик.

## Описание

Embeddings создают числовые векторные представления автомобилей, которые позволяют находить похожие автомобили по их характеристикам. Это дополняет SPARQL запросы, позволяя находить автомобили по "похожести", а не только по точным критериям.

## Архитектура

### 1. Извлечение признаков
Для каждого автомобиля извлекаются 23 признака:
- **Числовые:** год, мощность, расход топлива, цена, рейтинг безопасности и т.д.
- **Категориальные:** производитель, тип кузова, тип привода, тип топлива
- **Выводимые:** надежность, семейность, экономичность, спортивность

### 2. Нормализация
Все признаки нормализуются с помощью `StandardScaler` для одинакового масштаба.

### 3. Снижение размерности
Применяется PCA для уменьшения размерности до 64 измерений (настраивается).

### 4. Сохранение
Embeddings сохраняются в формате:
- `vehicle_embeddings.npy` - матрица embeddings
- `vehicle_index.json` - индекс соответствия имени автомобиля и позиции в матрице
- `scaler.pkl` - нормализатор для новых данных

## Использование

### Создание embeddings

```bash
# Создать embeddings для всех автомобилей
python create_embeddings.py

# Создать embeddings для первых 1000 автомобилей (для тестирования)
python create_embeddings.py --limit 1000

# Создать embeddings с размерностью 128
python create_embeddings.py --dim 128
```

### Поиск с использованием embeddings

```bash
python search_with_embeddings.py
```

## Примеры использования

### 1. Поиск по характеристикам

```python
from search_with_embeddings import search_by_embedding, load_embeddings

embeddings, vehicle_index, scaler = load_embeddings()

# Ищем экономичный семейный автомобиль
query_features = {
    'city_mpg': 30.0,
    'crash_rating': 5,
    'trunk_volume': 20.0,
    'family_score': 8.0,
    'msrp': 25000.0
}

results = search_by_embedding(query_features, embeddings, vehicle_index, scaler, top_k=10)
```

### 2. Поиск похожих автомобилей

```python
from search_with_embeddings import search_by_example_vehicle, load_embeddings

embeddings, vehicle_index, scaler = load_embeddings()

# Ищем похожие на BMW 3 Series 2016
similar = search_by_example_vehicle("BMW_3_Series_2016_145", embeddings, vehicle_index, top_k=5)
```

## Интеграция с SPARQL

Embeddings можно использовать для:
1. **Дополнительной фильтрации** результатов SPARQL запросов
2. **Ранжирования** результатов по похожести
3. **Рекомендаций** похожих автомобилей

## Преимущества

- **Семантический поиск:** находит автомобили по "похожести", а не только по точным критериям
- **Гибкость:** можно искать по любым комбинациям характеристик
- **Быстрый поиск:** векторные операции очень быстрые
- **Масштабируемость:** работает с большим количеством автомобилей

## Технические детали

### Размерность embeddings
По умолчанию: 64 измерения
- Можно увеличить для большей точности (но больше памяти)
- Можно уменьшить для экономии памяти

### Метрика сходства
Используется **косинусное сходство**:
- Диапазон: -1 до 1
- 1 = идентичные автомобили
- 0 = ортогональные (не похожие)
- -1 = противоположные

### Производительность
- Создание embeddings: ~1-2 минуты для 10,000 автомобилей
- Поиск: < 1 секунда для любого запроса

## Файлы

- `create_embeddings.py` - создание embeddings
- `search_with_embeddings.py` - поиск с использованием embeddings
- `embeddings/` - директория с сохраненными embeddings

