# Выводимые свойства автомобилей

Этот документ описывает выводимые (inferred) свойства, которые вычисляются на основе существующих данных в онтологии.

## Новые свойства

### 1. ReliabilityScore (Надежность)
**Тип:** `float` (0-10)  
**Описание:** Оценка надежности автомобиля на основе нескольких факторов.

**Формула вычисления:**
- **Рейтинг безопасности (40%):** `(OverallCrashRating / 5) * 10 * 0.4`
  - Если рейтинг отсутствует, используется среднее значение 5.0
- **Год выпуска (30%):** `((Year - 2011) / 6) * 10 * 0.3`
  - Более новые автомобили (2017) получают более высокий балл
- **Популярность (30%):** `min((Popularity / 10000) * 10, 10) * 0.3`
  - Популярные автомобили считаются более надежными

**Пример:**
- Автомобиль с рейтингом 5/5, 2017 года, популярностью 8000 → ReliabilityScore ≈ 8.5/10

---

### 2. FuelEfficiencyLevel (Уровень экономичности)
**Тип:** `string`  
**Значения:** `"Very High"`, `"High"`, `"Medium"`, `"Low"`, `"Very Low"`  
**Описание:** Уровень экономичности на основе расхода топлива.

**Критерии (на основе литров на 100 км):**
- **Very High:** ≤ 5.9 l/100km (≈ ≥ 40 MPG)
- **High:** ≤ 7.8 l/100km (≈ ≥ 30 MPG)
- **Medium:** ≤ 11.8 l/100km (≈ ≥ 20 MPG)
- **Low:** ≤ 15.7 l/100km (≈ ≥ 15 MPG)
- **Very Low:** > 15.7 l/100km (< 15 MPG)

**Формула:** 
1. Вычисляется средний MPG: `(CityMPG + HighwayMPG) / 2` или используется одно из значений
2. Конвертируется в литры на 100 км: `235.2 / avg_MPG = l/100km`
3. Определяется уровень на основе литров на 100 км

**Пример:**
- CityMPG = 35, HighwayMPG = 45 → средний = 40 MPG → 235.2/40 = 5.88 l/100km → `"Very High"`

---

### 3. SportinessLevel (Уровень спортивности)
**Тип:** `string`  
**Значения:** `"Very High"`, `"High"`, `"Medium"`, `"Low"`, `"Very Low"`  
**Описание:** Уровень спортивности на основе мощности, сегмента и типа кузова.

**Критерии (балльная система 0-11):**

**Мощность (0-5 баллов):**
- ≥ 400 л.с. → 5 баллов
- ≥ 300 л.с. → 4 балла
- ≥ 200 л.с. → 3 балла
- ≥ 150 л.с. → 2 балла
- ≥ 100 л.с. → 1 балл

**Сегмент рынка (0-3 балла) - учитываются ВСЕ сегменты:**
- High-Performance, Exotic → 3 балла
- Performance, Factory_Tuner → 2.5 балла
- Luxury → 1.5 балла
- Crossover → 1 балл
- Hatchback → 0.5 балла
- Hybrid, Diesel, Flex_Fuel, NA → 0 баллов
- Если несколько сегментов, берется максимальный балл

**Тип кузова (0-3 балла) - учитываются ВСЕ типы кузова:**
- Convertible (не SUV), Coupe → 3 балла
- Convertible SUV, 2dr Hatchback/SUV → 2 балла
- 4dr Hatchback → 1.5 балла
- Wagon → 1 балл
- Sedan, 4dr/2dr SUV → 0.5 балла
- Pickup → 0.25 балла
- Minivan, Van → 0 баллов

**Итоговый уровень:**
- ≥ 9 баллов → `"Very High"`
- ≥ 6 баллов → `"High"`
- ≥ 3 балла → `"Medium"`
- ≥ 1 балл → `"Low"`
- < 1 балл → `"Very Low"`

**Пример:**
- 350 л.с., High-Performance сегмент (3), Coupe (3) → 4 + 3 + 3 = 10 баллов → `"Very High"`
- 150 л.с., Luxury сегмент (1.5), Sedan (0.5) → 2 + 1.5 + 0.5 = 4 балла → `"Medium"`
- 100 л.с., NA сегмент (0), Minivan (0) → 1 + 0 + 0 = 1 балл → `"Low"`

---

### 4. FamilyFriendlinessScore (Семейность)
**Тип:** `float` (0-10)  
**Описание:** Оценка пригодности для семьи на основе безопасности, багажника и количества дверей.

**Формула вычисления:**
- **Рейтинг безопасности (40%):** `(OverallCrashRating / 5) * 10 * 0.4`
- **Объем багажника (30%):** `min((TrunkVolume / 30) * 10, 10) * 0.3`
  - Предполагается максимум 30 куб.фт
- **Количество дверей (30%):**
  - ≥ 4 двери → 10.0
  - 3 двери → 7.0
  - < 3 двери → 5.0

**Пример:**
- Рейтинг 5/5, багажник 20 куб.фт, 4 двери → (10 * 0.4) + (6.67 * 0.3) + (10 * 0.3) ≈ 8.0/10

---

### 5. ValueForMoneyScore (Соотношение цена/качество)
**Тип:** `float` (0-10)  
**Описание:** Оценка соотношения цены и качества автомобиля.

**Формула вычисления:**

**Ценность (value) = 0-10 баллов:**
- Рейтинг безопасности: `(OverallCrashRating / 5) * 3`
- Мощность: `min((EngineHP / 500) * 3, 3)`
- Экономичность (на основе литров на 100 км):
  - ≤ 5.9 l/100km (≥ 40 MPG) → 4 балла
  - ≤ 7.8 l/100km (≥ 30 MPG) → 3 балла
  - ≤ 11.8 l/100km (≥ 20 MPG) → 2 балла
  - ≤ 15.7 l/100km (≥ 15 MPG) → 1 балл

**Нормализованная цена:** `min((MSRP / 50000) * 10, 10)`

**Итоговый score:** `min((value / normalized_price) * 10, 10)`

**Пример:**
- Рейтинг 5/5, 200 л.с., 35 MPG, цена $20,000
- value = 3 + 1.2 + 3 = 7.2
- normalized_price = 4.0
- score = (7.2 / 4.0) * 10 = 18 → ограничено до 10.0

---

## Использование в SPARQL запросах

### Пример 1: Поиск надежных автомобилей
```sparql
SELECT ?vehicle ?reliability
WHERE {
    ?vehicle rdf:type :Vehicle .
    ?vehicle :ReliabilityScore ?reliability .
    FILTER (?reliability >= 7.0)
}
ORDER BY DESC(?reliability)
```

### Пример 2: Поиск экономичных автомобилей
```sparql
SELECT ?vehicle ?efficiency
WHERE {
    ?vehicle rdf:type :Vehicle .
    ?vehicle :FuelEfficiencyLevel ?efficiency .
    FILTER (?efficiency = "Very High" || ?efficiency = "High")
}
```

### Пример 3: Поиск спортивных автомобилей
```sparql
SELECT ?vehicle ?sportiness
WHERE {
    ?vehicle rdf:type :Vehicle .
    ?vehicle :SportinessLevel ?sportiness .
    FILTER (?sportiness = "Very High" || ?sportiness = "High")
}
```

### Пример 4: Поиск семейных автомобилей
```sparql
SELECT ?vehicle ?familyScore
WHERE {
    ?vehicle rdf:type :Vehicle .
    ?vehicle :FamilyFriendlinessScore ?familyScore .
    FILTER (?familyScore >= 7.0)
}
ORDER BY DESC(?familyScore)
```

### Пример 5: Лучшее соотношение цена/качество
```sparql
SELECT ?vehicle ?value ?price
WHERE {
    ?vehicle rdf:type :Vehicle .
    ?vehicle :ValueForMoneyScore ?value .
    ?vehicle :MSRP ?price .
    FILTER (?value >= 7.0 && ?price <= 20000)
}
ORDER BY DESC(?value) ASC(?price)
```

---

## Добавление свойств к онтологии

Для добавления выводимых свойств ко всем автомобилям используйте скрипт:

```bash
python add_inferred_properties.py
```

Или для ограниченного количества (для тестирования):

```bash
python add_inferred_properties.py --limit 100
```

---

## Преимущества выводимых свойств

1. **Упрощение запросов:** Не нужно вычислять сложные формулы в каждом SPARQL запросе
2. **Производительность:** Значения вычисляются один раз и сохраняются
3. **Читаемость:** Запросы становятся более понятными
4. **Гибкость:** Можно легко изменить алгоритм вычисления в одном месте

---

## Примечания

- Выводимые свойства вычисляются на основе существующих данных
- Если исходные данные отсутствуют, используются средние значения или свойства не устанавливаются
- Все значения округляются до 2 знаков после запятой для числовых свойств
- Свойства можно обновить, перезапустив скрипт `add_inferred_properties.py`

